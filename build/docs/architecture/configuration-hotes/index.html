<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-architecture/configuration-hotes" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.3.2">
<title data-rh="true">4. Configuration des hôtes | B2 UF Infra</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://github.com/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://github.com/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://github.com/docs/architecture/configuration-hotes"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="4. Configuration des hôtes | B2 UF Infra"><meta data-rh="true" name="description" content="4.1. Serveurs pfSense"><meta data-rh="true" property="og:description" content="4.1. Serveurs pfSense"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://github.com/docs/architecture/configuration-hotes"><link data-rh="true" rel="alternate" href="https://github.com/docs/architecture/configuration-hotes" hreflang="en"><link data-rh="true" rel="alternate" href="https://github.com/docs/architecture/configuration-hotes" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.40769eb2.css">
<script src="/assets/js/runtime~main.ad634209.js" defer="defer"></script>
<script src="/assets/js/main.8cf23652.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="B2 UF Infra Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="B2 UF Infra Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">B2 UF Infra</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/category/documentation-darchitecture">Documentation</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/documentation-darchitecture">Documentation d&#x27;architecture</a><button aria-label="Collapse sidebar category &#x27;Documentation d&#x27;architecture&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/Introduction">1. Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/infrastructure-generale">2. Infrastructure générale</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/composants-applicatifs">3. Liste des composants applicatifs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/architecture/configuration-hotes">4. Configuration des hôtes</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/documentation-dexploitation">Documentation d&#x27;exploitation</a><button aria-label="Expand sidebar category &#x27;Documentation d&#x27;exploitation&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/gestion-projet">Documentation de gestion de projet</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/documentation-darchitecture"><span itemprop="name">Documentation d&#x27;architecture</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">4. Configuration des hôtes</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>4. Configuration des hôtes</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="41-serveurs-pfsense">4.1. Serveurs pfSense<a href="#41-serveurs-pfsense" class="hash-link" aria-label="Direct link to 4.1. Serveurs pfSense" title="Direct link to 4.1. Serveurs pfSense">​</a></h2>
<p><strong>Attention</strong> : Il est important de rappeler que deux serveurs pfSense sont à configurer (il est à vous de décider lequel est le principal et lequel est le secondaire). Il est conseillé de bien faire attention à quelle machine est concernée par chaque étape de la configuration, puisque <strong>même après la configuration de la synchronisation, certaines manipulations devront être réalisées sur les deux machines</strong>.</p>
<p>La configuration suivante part du principe que le système d&#x27;exploitation a été installé au préalable selon les paramètres désirés et que la machine affiche cet écran :</p>
<p><img decoding="async" loading="lazy" src="/assets/images/pfsense_main-6f0cef5653435b97833df1910279be13.png" width="750" height="343" class="img_ev3q"></p>
<p><strong>Note</strong> : Tant que le pare-feu n&#x27;a pas été configuré, il faudra désactiver celui-ci avec la commande <code>pfctl -d</code> dans l&#x27;<strong>option 8 du menu</strong> afin de pouvoir accéder à l&#x27;interface graphique du routeur. Cette désactivation du pare-feu <strong>ne persiste pas après un redémarrage</strong>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="411-configuration-des-interfaces">4.1.1. Configuration des interfaces<a href="#411-configuration-des-interfaces" class="hash-link" aria-label="Direct link to 4.1.1. Configuration des interfaces" title="Direct link to 4.1.1. Configuration des interfaces">​</a></h3>
<p>Une fois le système installé, chaque NIC doit être attribuée à la bonne interface et recevoir une adresse IP. De base, comme montré sur l&#x27;image précédente, seule deux interfaces sont actives, les autres étant masquées.</p>
<p>Tant que les interfaces ne sont pas nommées, il faut partir des correspondances suivantes :</p>
<table><thead><tr><th>Nom par défaut de l&#x27;interface</th><th>Nom final</th></tr></thead><tbody><tr><td>LAN</td><td>LAN-OFFICE</td></tr><tr><td>OPT1</td><td>LAN-SERV</td></tr><tr><td>OPT2</td><td>DMZ</td></tr><tr><td>OPT3</td><td>SYNC</td></tr><tr><td>OPT4</td><td>HONEYPOT</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4111-attribution-des-interfaces">4.1.1.1. Attribution des interfaces<a href="#4111-attribution-des-interfaces" class="hash-link" aria-label="Direct link to 4.1.1.1. Attribution des interfaces" title="Direct link to 4.1.1.1. Attribution des interfaces">​</a></h4>
<p>Il est possible d&#x27;attribuer chaque carte réseau à la bonne interface en utilisant l&#x27;<strong>option 1 du menu</strong>.
L&#x27;attribution doit être réalisée <strong>sur les deux machines</strong>. Le résultat devrait être de cet ordre :</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="759" height="177" class="img_ev3q"></p>
<p>Les interfaces doivent <strong>être assignées dans le même ordre et avec le même nom sur les deux serveurs</strong>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4112-attribution-des-ip">4.1.1.2. Attribution des IP<a href="#4112-attribution-des-ip" class="hash-link" aria-label="Direct link to 4.1.1.2. Attribution des IP" title="Direct link to 4.1.1.2. Attribution des IP">​</a></h4>
<p>Les adresses IP doivent être configurées avec l&#x27;<strong>option 2 du menu</strong>. Elles doivent être configurées sur les <strong>deux serveurs</strong> et doivent être différentes sur les deux machines.</p>
<p><strong>Chaque attribution doit se faire de manière suivante :</strong></p>
<ul>
<li>Les IP doivent être statiques (et non entrées par DHCP) ;</li>
<li>Ne pas configurer d&#x27;IPv6</li>
<li>Ne pas activer de DHCP</li>
<li>Ne pas changer le protocole du <code>webConfigurator</code></li>
</ul>
<p>Les adresses <code>WAN</code> sont propres à votre réseau relié à Internet, c&#x27;est à vous de les définir. Celles utilisées dans l&#x27;exemple, entre crochets, doivent être remplacées par les IP fixes relatives à votre <code>WAN</code>.</p>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="pf_master"><code>PF_MASTER</code><a href="#pf_master" class="hash-link" aria-label="Direct link to pf_master" title="Direct link to pf_master">​</a></h6>
<table><thead><tr><th>Interface</th><th>IP</th><th>Masque</th><th>Passerelle</th></tr></thead><tbody><tr><td>WAN</td><td>[ 192.168.1.52 ]</td><td>[ 24 ]</td><td>[ 192.168.1.254 ]</td></tr><tr><td>LAN (LAN-OFFICE)</td><td>10.10.0.252</td><td>24</td><td><em>(none)</em></td></tr><tr><td>OPT1 (LAN-SERV)</td><td>10.10.0.252</td><td>24</td><td><em>(none)</em></td></tr><tr><td>OPT2 (DMZ)</td><td>10.10.10.252</td><td>28</td><td><em>(none)</em></td></tr><tr><td>OPT3 (SYNC)</td><td>172.16.0.252</td><td>28</td><td><em>(none)</em></td></tr><tr><td>OPT4 (HONEYPOT)</td><td>10.10.11.252</td><td>29</td><td><em>(none)</em></td></tr></tbody></table>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="pf_backup"><code>PF_BACKUP</code><a href="#pf_backup" class="hash-link" aria-label="Direct link to pf_backup" title="Direct link to pf_backup">​</a></h6>
<table><thead><tr><th>Interface</th><th>IP</th><th>Masque</th><th>Passerelle</th></tr></thead><tbody><tr><td>WAN</td><td>[ 192.168.1.53 ]</td><td>[ 24 ]</td><td>[ 192.168.1.53 ]</td></tr><tr><td>LAN (LAN-OFFICE)</td><td>10.10.0.253</td><td>24</td><td><em>(none)</em></td></tr><tr><td>OPT1 (LAN-SERV)</td><td>10.10.0.253</td><td>24</td><td><em>(none)</em></td></tr><tr><td>OPT2 (DMZ)</td><td>10.10.10.253</td><td>28</td><td><em>(none)</em></td></tr><tr><td>OPT3 (SYNC)</td><td>172.16.0.253</td><td>28</td><td><em>(none)</em></td></tr><tr><td>OPT4 (HONEYPOT)</td><td>10.10.11.253</td><td>29</td><td><em>(none)</em></td></tr></tbody></table>
<p>Une fois l&#x27;IP configurée sur le <code>WAN</code>, nous pouvons accéder à ceux-ci par leur adresse IP par le biais d&#x27;une machine connectée sur le même réseau. A noter qu&#x27;il faudra réaliser la commande citée en haut de cette partie (<code>pfctl -d</code>) afin de pouvoir accéder au GUI.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="412-paramétrage-basique-des-serveurs">4.1.2. Paramétrage basique des serveurs<a href="#412-paramétrage-basique-des-serveurs" class="hash-link" aria-label="Direct link to 4.1.2. Paramétrage basique des serveurs" title="Direct link to 4.1.2. Paramétrage basique des serveurs">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4121-nom-dhôte-et-domaine">4.1.2.1. Nom d&#x27;hôte et domaine<a href="#4121-nom-dhôte-et-domaine" class="hash-link" aria-label="Direct link to 4.1.2.1. Nom d&#x27;hôte et domaine" title="Direct link to 4.1.2.1. Nom d&#x27;hôte et domaine">​</a></h4>
<p>Sur le GUI des <strong>deux serveurs</strong>, dans l&#x27;onglet <code>System &gt; General Setup</code>, veillez à modifier le <code>hostname</code> et le <code>domain</code> selon les paramètres voulus.</p>
<p><code>PF_MASTER</code> :</p>
<ul>
<li>Hostname : <code>pf_master</code></li>
<li>Domain : <code>infra_lan</code>
<code>PF_BACKUP</code> :</li>
<li>Hostname : <code>pf_backup</code></li>
<li>Domain : <code>infra.lan</code></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4122-noms-dinterfaces">4.1.2.2. Noms d&#x27;interfaces<a href="#4122-noms-dinterfaces" class="hash-link" aria-label="Direct link to 4.1.2.2. Noms d&#x27;interfaces" title="Direct link to 4.1.2.2. Noms d&#x27;interfaces">​</a></h4>
<p>Sur le GUI des <strong>deux serveurs</strong>, dans l&#x27;onglet <code>Interfaces &gt; Assignements</code>, sur toutes les interfaces portant un nom temporaire (<code>LAN</code> et <code>OPT*</code>), veillez à modifier leur <code>Description</code> selon le tableau de correspondance plus haut.</p>
<p>Sur toutes les interfaces, veillez à décocher l&#x27;option en bas de page <code>Block private networks and loopback addresses</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="413-configuration-de-la-haute-disponibilité-failover">4.1.3. Configuration de la haute disponibilité (<code>failover</code>)<a href="#413-configuration-de-la-haute-disponibilité-failover" class="hash-link" aria-label="Direct link to 413-configuration-de-la-haute-disponibilité-failover" title="Direct link to 413-configuration-de-la-haute-disponibilité-failover">​</a></h3>
<p>Les deux serveurs, bien qu&#x27;ils présentent des IP différentes à des fins de bon fonctionnement, devront apparaître comme un seul routeur pour toutes les autres machines du réseau.</p>
<p>Le principe de la <a href="https://docs.netgate.com/pfsense/en/latest/recipes/high-availability.html#table-ha-lan-ip-address-assignments" target="_blank" rel="noopener noreferrer">haute disponibilité</a> (<code>High Availability</code>) est de leur attribuer une IP virtuelle commune sur chaque interface, qui sera celle utilisée par toutes les autres machines du réseau. Ainsi, en cas de panne, <code>PF_BACKUP</code> prendra le relais mais puisque l&#x27;adresse virtuelle n&#x27;aura pas changé, ce relais sera réalisé en toute transparence pour les utilisateurs.</p>
<p>Il convient donc dans un premier temps de définir les IP virtuelles :</p>
<table><thead><tr><th>Interface</th><th>CARP VIP</th><th>Masque</th></tr></thead><tbody><tr><td>WAN</td><td>[ 192.168.1.54 ]</td><td>24</td></tr><tr><td>LAN-OFFICE</td><td>10.10.0.254</td><td>24</td></tr><tr><td>LAN-SERV</td><td>10.10.1.254</td><td>24</td></tr><tr><td>DMZ</td><td>10.10.10.254</td><td>28</td></tr><tr><td>HONEYPOT</td><td>10.10.10.254</td><td>28</td></tr></tbody></table>
<p>L&#x27;interface <code>SYNC</code> n&#x27;est pas concernée, puisqu&#x27;aucune machine externe n&#x27;y accèdera : son seul but est de synchroniser les paramètres de <code>PF_MASTER</code> avec <code>PF_BACKUP</code>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4131-mise-en-place-de-la-synchronisation">4.1.3.1. Mise en place de la synchronisation<a href="#4131-mise-en-place-de-la-synchronisation" class="hash-link" aria-label="Direct link to 4.1.3.1. Mise en place de la synchronisation" title="Direct link to 4.1.3.1. Mise en place de la synchronisation">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="interface-sync">Interface <code>SYNC</code><a href="#interface-sync" class="hash-link" aria-label="Direct link to interface-sync" title="Direct link to interface-sync">​</a></h5>
<p>Pour permettre la synchronisation de configuration des pfSense par l&#x27;interface <code>SYNC</code>, les règles suivantes doivent être mises en place <strong>sur les deux serveurs</strong>, dans l&#x27;onglet <code>Firewall &gt; Rules &gt; SYNC</code> :</p>
<p>![](./img/Pasted image 20240621164635.png)</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="configuration-du-state-synchronisation">Configuration du State Synchronisation<a href="#configuration-du-state-synchronisation" class="hash-link" aria-label="Direct link to Configuration du State Synchronisation" title="Direct link to Configuration du State Synchronisation">​</a></h5>
<p>Sur <code>PF_MASTER</code> <strong>puis</strong> sur <code>PF_BACKUP</code>, dans l&#x27;onglet `System &gt; High Avail Sync :</p>
<ul>
<li>Checker <code>Synchronise States</code> ;</li>
<li>Mettre la valeur de <code>Synchronize Interface</code> à <code>SYNC</code> ;</li>
<li>Remplir le <code>Filter Host ID</code> (<code>1</code> sur <code>PF_MASTER</code>, <code>2</code> sur <code>PF_BACKUP</code>) ;</li>
<li>Remplir <code>pfsync Synchronize Peer IP</code> avec l&#x27;IP <code>SYNC</code> de l&#x27;autre serveur ;</li>
<li>Cliquer sur <code>Save</code>.</li>
</ul>
<p>Sur <code>PF_MASTER</code> <strong>seulement</strong>, dans l&#x27;onglet <code>System &gt; High Avail Sync</code> :</p>
<ul>
<li>Remplir <code>Synchronize Config to IP</code> à l&#x27;IP <code>SYNC</code> de <code>PF_BACKUP</code> (172.16.0.252) ;</li>
<li>Remplir <code>Remote System Username</code> à <code>admin</code> ;</li>
<li>Remplir <code>Remote System Password</code> à la valeur du mot de passe (<code>pfsense</code> par défaut) ;</li>
<li>Cocher toutes les cases de <code>Select options to sync</code>.</li>
</ul>
<p>La synchronisation devrait être complète et peut être vérifiée par exemple en ajoutant une règle de pare-feu dans <code>PF_MASTER</code>, qui devrait automatiquement être copiée à <code>PF_BACKUP</code>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4132-configuration-des-ip-virtuelles-carp">4.1.3.2. Configuration des IP Virtuelles <code>CARP</code><a href="#4132-configuration-des-ip-virtuelles-carp" class="hash-link" aria-label="Direct link to 4132-configuration-des-ip-virtuelles-carp" title="Direct link to 4132-configuration-des-ip-virtuelles-carp">​</a></h4>
<p><strong>Sur <code>PF_MASTER</code> seulement</strong>, dans l&#x27;onglet <code>Firewall &gt; Virtual IP</code>, cliquer sur <code>+</code> pour créer une nouvelle IP virtuelle, pour chaque interface concernée (voir le tableau <code>4.3.1</code>), avec les paramètres suivants :</p>
<ul>
<li><code>Type</code> : <code>CARP</code></li>
<li><code>Interface</code> : Interface choisie pour la <code>VIP</code></li>
<li><code>Addresses(es)</code> : <code>CARP VIP</code> et <code>Masque</code> correspondant à l&#x27;interface choisie dans `4.3.1</li>
<li><code>Virtual IP Password</code> : Créer un password pour l&#x27;interface (ne sert qu&#x27;à être partagé entre les deux serveurs)</li>
<li><code>VHID Group</code> : Identificateur du <code>CARP VIP</code>. Doit être différent pour chaque interface, une technique commune est de se baser sur un octet du réseau.</li>
<li><code>Advertising frequency</code> : <code>1</code> (doit être identiques les deux serveurs)</li>
<li><code>Skew</code> : <code>O</code></li>
<li><code>Description</code> : par exemple, <code>WAN CARP VIP</code>.</li>
</ul>
<p><strong>Note</strong>:</p>
<ul>
<li>Le <code>Skew</code> est de <code>1</code> pour le <code>primary node</code> et doit être au-dessus de <code>100</code> pour des nodes secondaires. Si la synchronisation fonctionne correctement, il sera automatiquement mis à <code>100</code> sur <code>PF_BACKUP</code> sans devoir être modifié à la main.</li>
</ul>
<p><img decoding="async" loading="lazy" src="/assets/images/vip-d166b3c24ea88c8851c590638b640bde.png" width="1260" height="259" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4134-configuration-de-loutbound-nat-pour-le-carp">4.1.3.4. Configuration de l&#x27;<code>Outbound NAT</code> pour le <code>CARP</code><a href="#4134-configuration-de-loutbound-nat-pour-le-carp" class="hash-link" aria-label="Direct link to 4134-configuration-de-loutbound-nat-pour-le-carp" title="Direct link to 4134-configuration-de-loutbound-nat-pour-le-carp">​</a></h4>
<p>Sur <code>PF_MASTER</code> <strong>seulement</strong>, dans <code>Firewall &gt; NAT &gt; Outbound</code> :</p>
<ul>
<li>Cocher <code>Mode</code> : <code>Hybrid Outbound NAT rule generation</code>.</li>
</ul>
<p>En plus des deux règles automatiques, créer les <code>mappings</code> suivants :
<img decoding="async" loading="lazy" src="/assets/images/outbound_mappings-6b3b39edd4d0f41362b2df31077c5193.png" width="1260" height="706" class="img_ev3q"></p>
<p>Une fois ces règles mises en place, il est possible de vérifier l&#x27;état des serveurs dans <code>Status &gt; CARP (failover)</code>.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="pf_master-1"><code>PF_MASTER</code><a href="#pf_master-1" class="hash-link" aria-label="Direct link to pf_master-1" title="Direct link to pf_master-1">​</a></h5>
<p><img decoding="async" loading="lazy" src="/assets/images/carp_master-4c34a211236d75071cc681d75231ca48.png" width="1264" height="424" class="img_ev3q"></p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="pf_backup-1"><code>PF_BACKUP</code><a href="#pf_backup-1" class="hash-link" aria-label="Direct link to pf_backup-1" title="Direct link to pf_backup-1">​</a></h5>
<p><img decoding="async" loading="lazy" src="/assets/images/carp_backup-b184f133981f6e0ed8b7c32315aebb82.png" width="1149" height="490" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="414-règles-de-base-du-pare-feu">4.1.4. Règles de base du pare-feu<a href="#414-règles-de-base-du-pare-feu" class="hash-link" aria-label="Direct link to 4.1.4. Règles de base du pare-feu" title="Direct link to 4.1.4. Règles de base du pare-feu">​</a></h3>
<p>Les règles de pare-feu doivent être mises en place <strong>uniquement par <code>PF_Master</code></strong> et dans <code>Firewall &gt; Rules</code>, sur l&#x27;interface choisie.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4130-aliases">4.1.3.0. Aliases<a href="#4130-aliases" class="hash-link" aria-label="Direct link to 4.1.3.0. Aliases" title="Direct link to 4.1.3.0. Aliases">​</a></h4>
<p>Des aliases peuvent être définis pour contenir des adresses IP ou des plages d&#x27;adresse IP sans avoir à les écrire en brut à plusieurs endroits. Ces aliases permettent une modification rapide et dynamiques des adresses qu&#x27;ils contiennent.</p>
<p>Dans l&#x27;onglet <code>Firewall &gt; Aliases</code> :
<img decoding="async" loading="lazy" src="/assets/images/firewall_aliases-30a6937e82d634bce6d526d7a3eec9bd.png" width="1154" height="288" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4131-wan">4.1.3.1. <code>WAN</code><a href="#4131-wan" class="hash-link" aria-label="Direct link to 4131-wan" title="Direct link to 4131-wan">​</a></h4>
<p><img decoding="async" loading="lazy" src="/assets/images/firewall_wan-e68a28cc4cc4b125c791006b82ce1b83.png" width="1155" height="412" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4132-lan-office">4.1.3.2. <code>LAN-OFFICE</code><a href="#4132-lan-office" class="hash-link" aria-label="Direct link to 4132-lan-office" title="Direct link to 4132-lan-office">​</a></h4>
<p><img decoding="async" loading="lazy" src="/assets/images/firewall_lanoffice-d0957e601099198fb9f9ac6c4a4eccbe.png" width="1272" height="552" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4133-lan-serv">4.1.3.3. <code>LAN-SERV</code><a href="#4133-lan-serv" class="hash-link" aria-label="Direct link to 4133-lan-serv" title="Direct link to 4133-lan-serv">​</a></h4>
<p><img decoding="async" loading="lazy" src="/assets/images/firewall_lanserv-214d5778b16dc66968a4857bedc7e87f.png" width="1266" height="720" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4134-dmz">4.1.3.4. <code>DMZ</code><a href="#4134-dmz" class="hash-link" aria-label="Direct link to 4134-dmz" title="Direct link to 4134-dmz">​</a></h4>
<p><img decoding="async" loading="lazy" src="/assets/images/firewall_dmz-ae71ee6fa6a778c6c98af43e2485f3b7.png" width="1272" height="478" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4135-sync">4.1.3.5. <code>SYNC</code><a href="#4135-sync" class="hash-link" aria-label="Direct link to 4135-sync" title="Direct link to 4135-sync">​</a></h4>
<p><img decoding="async" loading="lazy" src="/assets/images/firewall_sync-750abbc31e7620525ad9c70449297a2e.png" width="1280" height="365" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4135-honeypot">4.1.3.5. <code>HONEYPOT</code><a href="#4135-honeypot" class="hash-link" aria-label="Direct link to 4135-honeypot" title="Direct link to 4135-honeypot">​</a></h4>
<p><img decoding="async" loading="lazy" src="/assets/images/firewall-honeypot-c1a2c5ca864997615a1655401833463a.png" width="1272" height="501" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="415-dhcp">4.1.5. DHCP<a href="#415-dhcp" class="hash-link" aria-label="Direct link to 4.1.5. DHCP" title="Direct link to 4.1.5. DHCP">​</a></h3>
<p>Le DHCP doit être activé <strong>uniquement par <code>PF_Master</code></strong> et dans <code>Services &gt; DHCP Server</code>, sur l&#x27;interface choisie.</p>
<p>Dans l&#x27;architecture présentée, seul le réseau <code>LAN-OFFICE</code> dispose d&#x27;une pool DHCP, les autres sous-réseaux étant tous des réseaux de maintenance ou des réseaux exclusivement occupés par des serveurs.</p>
<p>S&#x27;il devait être mis en place sur d&#x27;autres interfaces, il est conseillé de suivre les mêmes étapes de configuration que pour <code>4.1.4.1</code>, à l&#x27;exception évidemment des adresses IP concernées.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4151-lan-office">4.1.5.1. <code>LAN-OFFICE</code><a href="#4151-lan-office" class="hash-link" aria-label="Direct link to 4151-lan-office" title="Direct link to 4151-lan-office">​</a></h4>
<p>Dans <code>Services &gt; DHCP Server</code> :</p>
<ul>
<li>Cocher <code>Enable DHCP server on LANOFFICE interface</code></li>
<li><code>Address Pool Range</code> : <code>10.10.0.1</code> to <code>10.10.0.200</code></li>
<li><code>DNS Servers</code> : IP virtuelle du pare-feu sur l&#x27;interface concernée, ici <code>10.10.0.254</code></li>
<li><code>Gateway</code> : IP virtuelle du pare-feu sur l&#x27;interface concernée, ici <code>10.10.0.254</code></li>
<li><code>Failover peer IP</code> : IP de <code>PF_BACKUP</code> sur l&#x27;interface concernée, ici <code>10.10.0.253</code></li>
</ul>
<p>S&#x27;il devait exister des IP fixes sur l&#x27;interface concernée (par exemple si l&#x27;on activait le DHCP sur l&#x27;interface <code>LAN-SERV</code>, contenant le serveur <code>web-backup</code>), il est fortement conseillé de rentrer les IP fixes du réseau dans les <code>DHCP Static Mappings</code>, tout en bas de la page.</p>
<p>De la même façon, il est conseillé d&#x27;exclure des pools DHCP les adresses réelles et virtuelle des routeurs pfSense.</p>
<p>L&#x27;état et les bails du serveur DHCP peuvent être vérifiés dans <code>Status &gt; DHCP Leases</code> :
<img decoding="async" loading="lazy" src="/assets/images/dhcp_lanoffice-4e9ddf64541972e2f1a34d09c120c3e6.png" width="1275" height="698" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="416-dns">4.1.6. DNS<a href="#416-dns" class="hash-link" aria-label="Direct link to 4.1.6. DNS" title="Direct link to 4.1.6. DNS">​</a></h3>
<p>Le serveur DNS s&#x27;active <strong>uniquement sur <code>PF_MASTER</code></strong>, dans <code>Services &gt; DNS Resolver &gt; General Settings</code> :</p>
<ul>
<li>Cocher <code>Enable DNS Server</code> ;</li>
<li>Mettre <code>All</code> sur <code>Network Interfaces</code> ;</li>
<li>Mettre <code>All</code> sur <code>Outgoing Network Interfaces</code> ;</li>
<li>Cocher <code>Register DHCP leases in the DNS resolver</code> ;</li>
<li>Cocher <code>Register DHCP static mappings in the DNS Resolver</code>.</li>
</ul>
<p>On peut enregistrer de nouvelles IP au DNS dans la partie <code>Host Overrides</code> en bas de page.</p>
<p>Dans le cadre de la mise en place du serveur web, dont le FDQN et l&#x27;adresse IP sont connus en avance, on peut déjà y ajouter l&#x27;entrée :
<img decoding="async" loading="lazy" src="/assets/images/dns_website-9ffaf576891e275f7ac613fed094fe75.png" width="1269" height="237" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="417-port-forwarding">4.1.7. Port Forwarding<a href="#417-port-forwarding" class="hash-link" aria-label="Direct link to 4.1.7. Port Forwarding" title="Direct link to 4.1.7. Port Forwarding">​</a></h3>
<p>Les règles de Port Forwarding s&#x27;activent <strong>uniquement sur <code>PF_MASTER</code></strong>, dans <code>Firewall &gt; NAT &gt; Port Forward</code>.</p>
<p>Puisque l&#x27;IP et le port du site web, devant être accessibles depuis l&#x27;extérieur, sont déjà connus, on peut créer la règle de port forwarding dès maintenant. Le but du port forward est d&#x27;intercepter une requête reçue du <code>WAN</code> vers un port spécifique du serveur (ici <code>80</code>) afin de renvoyer cette requête vers le port d&#x27;une machine normalement inaccessible.
<img decoding="async" loading="lazy" src="/assets/images/port_forward_1-a9f6e842b42ada22fd1b91be50e92710.png" width="1271" height="239" class="img_ev3q"></p>
<p>A noter toutefois que le WAN n&#x27;aura pas accès à l&#x27;entrée DNS correspondant au serveur web et devra passer directement par la <code>CARP VIP</code> des routeurs pfSense dans le <code>WAN</code>, sauf si les machines voulant accéder au site entrent la <code>CARP VIP</code> des routeurs pfSense dans leurs <code>DNS</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="418-ripv2">4.1.8. RIPv2<a href="#418-ripv2" class="hash-link" aria-label="Direct link to 4.1.8. RIPv2" title="Direct link to 4.1.8. RIPv2">​</a></h3>
<p>Puisque l&#x27;utilisation du protocole dynamique de routage <code>RIPv2</code> passe par l&#x27;utilisation d&#x27;un package, son installation et sa configuration ne sont pas incluses dans les paramètres automatiquement synchronisés entre les deux pfSense.</p>
<p>De cette façon, <strong>toutes les manipulations suivantes sont à réaliser sur <code>PF_MASTER</code> et sur <code>PF_BACKUP</code>.</strong></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4161-installation-du-package-ffr">4.1.6.1. Installation du package <code>FFR</code><a href="#4161-installation-du-package-ffr" class="hash-link" aria-label="Direct link to 4161-installation-du-package-ffr" title="Direct link to 4161-installation-du-package-ffr">​</a></h4>
<p>Dans <code>System &gt; Package Manager</code>, rechercher et installer le package <code>ffr</code> :<br>
<img decoding="async" loading="lazy" src="/assets/images/pkg_frr-b09fed460acb67b680f93760097d738b.png" width="1275" height="276" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4162-configuration-du-routage-par-ripv2">4.1.6.2. Configuration du routage par RIPv2<a href="#4162-configuration-du-routage-par-ripv2" class="hash-link" aria-label="Direct link to 4.1.6.2. Configuration du routage par RIPv2" title="Direct link to 4.1.6.2. Configuration du routage par RIPv2">​</a></h4>
<p>Dans <code>Services &gt; FRR &gt; Global Settings</code> :</p>
<ul>
<li>Cocher <code>Enable FRR</code> ;</li>
<li>Entrer un <code>Master Password</code>.</li>
</ul>
<p>Dans <code>Services &gt; FRR &gt; RIP &gt; RIP</code></p>
<ul>
<li>Cocher <code>Enable RIP Routing</code> ;</li>
<li>Dans <code>RIP Networks</code>, entrer les adresse réseau et masque de toutes les interfaces concernées (toutes sauf <code>SYNC</code>) ;</li>
<li>Dans <code>RIP Version</code>, entrer <code>RIPv2</code> ;</li>
<li>Cliquer sur <code>Save</code>.</li>
</ul>
<p>Le fonctionnement du protocole de routage peut être vérifié dans <code>Services &gt; FRR &gt; Status &gt; RIP</code> :
<img decoding="async" loading="lazy" src="/assets/images/check_rip-da83778fc5ffbb6446726e74d79b33c8.png" width="865" height="578" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="419-portail-captif">4.1.9. Portail captif<a href="#419-portail-captif" class="hash-link" aria-label="Direct link to 4.1.9. Portail captif" title="Direct link to 4.1.9. Portail captif">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4110-sauvegarde-automatique-de-la-configuration">4.1.10. Sauvegarde automatique de la configuration<a href="#4110-sauvegarde-automatique-de-la-configuration" class="hash-link" aria-label="Direct link to 4.1.10. Sauvegarde automatique de la configuration" title="Direct link to 4.1.10. Sauvegarde automatique de la configuration">​</a></h3>
<p>L&#x27;administrateur peut choisir de réaliser les sauvegardes automatiques seulement sur <code>PF_MASTER</code>, ou sur <code>PF_MASTER</code> et <code>PF_BACKUP</code>. Dans les deux cas, la procédure est la même et doit être réalisée sur chaque machine, dans <code>Services &gt; Auto Configuration Backup &gt; Settings</code> :</p>
<ul>
<li>Cocher <code>Enable automatic configuration backup</code> ;</li>
<li>Pour réaliser une backup journalière, cocher <code>Automatically backup on a regular schedule</code> et entrer <code>5 | 0 | * | * | *</code> dans <code>Schedule</code> ; sinon, cocher <code>Automatically backup on every configuration change</code> ;</li>
<li>Par sécurité, entrer un mot de passe dans <code>Encryption Password</code> ;</li>
<li>Dans <code>Manual backups to keep</code>, la valeur est libre ; ici nous mettrons <code>20</code> backups manuelles sur le total de <code>100</code> backups conservées ;</li>
<li>Cocher <code>List backups in descending order</code>.</li>
</ul>
<p>Les backups peuvent être récupérées dans <code>Services &gt; Auto Configuration Backup &gt; Restore</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4111-proxy-inverse">4.1.11. Proxy Inverse<a href="#4111-proxy-inverse" class="hash-link" aria-label="Direct link to 4.1.11. Proxy Inverse" title="Direct link to 4.1.11. Proxy Inverse">​</a></h3>
<p>Puisque l&#x27;utilisation du proxy inverse passe par l&#x27;utilisation d&#x27;un package, son installation et sa configuration ne sont pas incluses dans les paramètres automatiquement synchronisés entre les deux pfSense.</p>
<p>De cette façon, <strong>toutes les manipulations suivantes sont à réaliser sur <code>PF_MASTER</code> et sur <code>PF_BACKUP</code>.</strong></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4161-installation-du-package-squid">4.1.6.1. Installation du package <code>squid</code><a href="#4161-installation-du-package-squid" class="hash-link" aria-label="Direct link to 4161-installation-du-package-squid" title="Direct link to 4161-installation-du-package-squid">​</a></h4>
<p>Dans <code>System &gt; Package Manager</code>, rechercher et installer le package <code>squid</code> :<br>
<img decoding="async" loading="lazy" src="/assets/images/squid-463452dec228448c97886af29e9a9cff.png" width="1274" height="142" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4162-configuration-du-proxy-inverse">4.1.6.2. Configuration du proxy inverse<a href="#4162-configuration-du-proxy-inverse" class="hash-link" aria-label="Direct link to 4.1.6.2. Configuration du proxy inverse" title="Direct link to 4.1.6.2. Configuration du proxy inverse">​</a></h4>
<p>Puisque nous n&#x27;aurons pas énormément d&#x27;intérêt à installer un reverse proxy, cette étape documentée plus tard, accompagnée d&#x27;une solution permettant le load-balancing.</p>
<p>Cependant, il est possible de configurer le proxy inverse en <a href="https://www.it-connect.fr/reverse-proxy-https-avec-pfsense/" target="_blank" rel="noopener noreferrer">suivant les étapes suivants</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="42-serveur-web-dmz">4.2. Serveur web (DMZ)<a href="#42-serveur-web-dmz" class="hash-link" aria-label="Direct link to 4.2. Serveur web (DMZ)" title="Direct link to 4.2. Serveur web (DMZ)">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="421-configuration-initiale">4.2.1. Configuration initiale<a href="#421-configuration-initiale" class="hash-link" aria-label="Direct link to 4.2.1. Configuration initiale" title="Direct link to 4.2.1. Configuration initiale">​</a></h3>
<table><thead><tr><th>Hostname</th><th>web-server</th></tr></thead><tbody><tr><td><strong>Domaine</strong></td><td>infra.uf</td></tr><tr><td><strong>Nom de l&#x27;utilisateur</strong></td><td>web-server</td></tr><tr><td><strong>Adresse IP</strong></td><td>10.10.10.242</td></tr><tr><td><strong>Masque de sous-réseau</strong></td><td>255.255.255.248 (/28)</td></tr><tr><td><strong>Passerelle par défaut</strong></td><td>10.10.10.254</td></tr><tr><td><strong>DNS</strong></td><td>10.10.10.254</td></tr><tr><td><strong>Ports ouverts</strong></td><td>80 (http), 22 (ssh)</td></tr></tbody></table>
<p>Il est conseillé d&#x27;utiliser le <a href="https://gitlab.com/kikinovak/rocky-8-server" target="_blank" rel="noopener noreferrer">script d&#x27;installation pour Rocky Linux 8.x</a> proposé par [<a href="https://www.microlinux.fr/%5D(Nicolas" target="_blank" rel="noopener noreferrer">https://www.microlinux.fr/](Nicolas</a> Kovacs), qui propose d&#x27;assainir une machine afin de la rendre plus facilement utilisable en tant que serveur.</p>
<p>Installer, si manquants après assainissement, les composants applicatifs vus dans <code>3.2.2</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="422-mise-en-place-du-serveur-web">4.2.2. Mise en place du serveur web<a href="#422-mise-en-place-du-serveur-web" class="hash-link" aria-label="Direct link to 4.2.2. Mise en place du serveur web" title="Direct link to 4.2.2. Mise en place du serveur web">​</a></h3>
<p>Afin de lancer le serveur Apache de manière permanente, réaliser la commande suivante :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl enable httpd --now</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Pour vérifier le bon fonctionnement du serveur il est possible d&#x27;installer le package <code>elinks</code> et réaliser la commande suivante :</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">elinks http://localhost</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Il suffit de modifier le contenu du dossier <code>var/www/html</code> afin de modifier le site web qui s&#x27;affichera sur la page. Si les règles de pare-feu et de port forward ont été réalisées pour <code>web-server</code>, le site est désormais accessible sur tous les réseaux à l&#x27;adresse <code>10.10.10.242:80</code>.</p>
<p>Si l&#x27;entrée correspondant à <code>web-server</code> a été ajoutée au DNS, tous les réseaux internes pourront accéder au site web à l&#x27;adresse <code>documentation.infra.lan:80</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="423-mise-en-place-des-fichiers-de-restauration">4.2.3. Mise en place des fichiers de restauration<a href="#423-mise-en-place-des-fichiers-de-restauration" class="hash-link" aria-label="Direct link to 4.2.3. Mise en place des fichiers de restauration" title="Direct link to 4.2.3. Mise en place des fichiers de restauration">​</a></h3>
<p>Les dossiers suivants et leurs permissions doivent être mis en place en <code>sudo</code> sur la machine :</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/home/			           	(755)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	web-server/			(755)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		scripts/	     	(755)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		    restore.sh	(700)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		temp/			    (777)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Le fichier <code>/home/web-server/scripts/restore.sh</code> doit contenir ce qui suit :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Checks arguments</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if [ $# -lt 1 ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo 1&gt;&amp;2 &quot;ERREUR: Argument manquant (nom du fichier à utiliser, situé dans le dossier ../temp)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exit 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">elif [ $# -gt 1 ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo 1&gt;&amp;2 &quot;ERREUR: Trop d&#x27;arguments (nom du fichier à utiliser seulement)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exit 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Takes first argument as filename</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">filename=$1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># If said file doesn&#x27;t exist:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if [ ! -f &quot;/home/web-server/temp/${filename}&quot; ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;ERREUR: Le fichier mentionné n&#x27;existe pas&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exit 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if [ ! -d &quot;/var/www/temp&quot; ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir &quot;/var/www/temp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if [ ! -d &quot;/home/web-server/temp&quot; ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir &quot;/home/web-server/temp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">file=&quot;${filename%%.*}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm -rf /var/www/html/* /var/www/temp/* /var/www/temp/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar xfz /home/web-server/temp/$filename -C /var/www/temp/ # Uncompresses the tar file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv /var/www/temp/&quot;$file&quot;/* /var/www/html/ # Moves the uncompressed files from the backup folder to the html folder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm -rf /var/www/temp /home/web-server/temp/ # Removes the temp folder</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="43-serveurs-web-backup-lan-serv">4.3. Serveurs web-backup (LAN-SERV)<a href="#43-serveurs-web-backup-lan-serv" class="hash-link" aria-label="Direct link to 4.3. Serveurs web-backup (LAN-SERV)" title="Direct link to 4.3. Serveurs web-backup (LAN-SERV)">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="431-configuration-initiale">4.3.1. Configuration initiale<a href="#431-configuration-initiale" class="hash-link" aria-label="Direct link to 4.3.1. Configuration initiale" title="Direct link to 4.3.1. Configuration initiale">​</a></h3>
<table><thead><tr><th>Hostname</th><th>web-backup</th></tr></thead><tbody><tr><td><strong>Domaine</strong></td><td>infra.uf</td></tr><tr><td><strong>Nom de l&#x27;utilisateur</strong></td><td>web-backup</td></tr><tr><td><strong>Adresse IP</strong></td><td>10.10.1.242</td></tr><tr><td><strong>Masque de sous-réseau</strong></td><td>255.255.255.0 (/24)</td></tr><tr><td><strong>Passerelle par défaut</strong></td><td>10.10.1.254</td></tr><tr><td><strong>DNS</strong></td><td>10.10.1.254</td></tr><tr><td><strong>Ports ouverts</strong></td><td>22 (ssh)</td></tr></tbody></table>
<p>Il est conseillé d&#x27;utiliser le <a href="https://gitlab.com/kikinovak/rocky-8-server" target="_blank" rel="noopener noreferrer">script d&#x27;installation pour Rocky Linux 8.x</a> proposé par [<a href="https://www.microlinux.fr/%5D(Nicolas" target="_blank" rel="noopener noreferrer">https://www.microlinux.fr/](Nicolas</a> Kovacs), qui propose d&#x27;assainir une machine afin de la rendre plus facilement utilisable en tant que serveur.</p>
<p>Installer, si manquants après assainissement, les composants applicatifs vus dans <code>3.2.2</code>.</p>
<p><strong>Note</strong> : Il convient de se connecter une première fois en SSH au serveur web avant d&#x27;exécuter l&#x27;un des scripts.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="432-mise-en-place-des-fichiers-de-sauvegarde-et-de-restauration">4.3.2. Mise en place des fichiers de sauvegarde et de restauration<a href="#432-mise-en-place-des-fichiers-de-sauvegarde-et-de-restauration" class="hash-link" aria-label="Direct link to 4.3.2. Mise en place des fichiers de sauvegarde et de restauration" title="Direct link to 4.3.2. Mise en place des fichiers de sauvegarde et de restauration">​</a></h3>
<p>Les dossiers suivants et leurs permissions doivent être mis en place en <code>sudo</code> sur la machine :</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/home/			           	    (755)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	backup-server/			    (755)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		backups/              (755)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		credentials/          (755)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			ws-ip.txt        (600)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			ws-pass.txt      (600)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		scripts/	     	    (755)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			backup.sh        (700)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			remove.sh        (700)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		    restore.sh	    (700)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		temp/			        (755)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4321-fichiers-credentials">4.3.2.1. Fichiers <code>/credentials/</code><a href="#4321-fichiers-credentials" class="hash-link" aria-label="Direct link to 4321-fichiers-credentials" title="Direct link to 4321-fichiers-credentials">​</a></h4>
<p>Dans le dossier <code>/home/backup-server/credentials/</code> :</p>
<ul>
<li><code>ws-ip.txt</code> : contient l&#x27;IP du serveur web (ici <code>10.10.10.242</code>)</li>
<li><code>ws-pass.txt</code> : contient le mot de passe <code>root</code> du serveur web</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4322-fichiers-scripts">4.3.2.2. Fichiers <code>/scripts/</code><a href="#4322-fichiers-scripts" class="hash-link" aria-label="Direct link to 4322-fichiers-scripts" title="Direct link to 4322-fichiers-scripts">​</a></h4>
<p>Le fichier <code>/home/web-server/scripts/backup.sh</code> doit contenir ce qui suit :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ip=$(&lt;/home/backup-server/credentials/ws-ip.txt)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">filename=&quot;backup_&quot;$(date +&quot;%y-%m-%d_%H-%M-%S&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;RETRIEVING DATA FROM WEB SERVER... ($ip)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sshpass -p &quot;root&quot; rsync -az -e ssh root@10.10.10.242:/var/www/html/ /home/backup-server/temp/&quot;$filename&quot;/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if [ &quot;$?&quot; -eq &quot;0&quot; ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cd /home/backup-server/temp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tar cfz /home/backup-server/backups/&quot;$filename&quot;.tar.gz &quot;$filename&quot;/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #rm -rf /home/backup-server/backups/&quot;$filename&quot;.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;Successfully created backup data.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;ERROR: Something went wrong when trying to communicate with the web server.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm -rf /home/backup-server/temp/&quot;$filename&quot;/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Le fichier <code>/home/web-server/scripts/remove.sh</code> doit contenir ce qui suit :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if [ -d &quot;/home/backup-server/temp&quot; ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rm -rf /home/backup-server/temp/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;Emptied temp folder.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if [ -d &quot;/home/backup-server/backups&quot; ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    find /home/backup-server/backups/*.tar.gz -mtime +0 -type f -delete</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;Successfully realised the operation.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    exit 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;ERROR: The directory doesn&#x27;t exist.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    exit 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Le fichier <code>/home/web-server/scripts/restore.sh</code> doit contenir ce qui suit :</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Retrieves the list of all the files in the backups folder.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">files=($(find /home/backup-server/backups/ -mtime -8 -type f -exec basename {} \;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># If there&#x27;s no file:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if [ -z &quot;$files&quot; ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   echo &quot;No backup files available for restore.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   exit 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Else:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Orders the file array elements by name:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IFS=$&#x27;\n&#x27; files=($(sort &lt;&lt;&lt; &quot;${files[*]}&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unset IFS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;Backup files available for restore:&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">i=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">while [ $i -lt ${#files[@]} ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   echo $i: ${files[$i]}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ((i++))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">printf &#x27;\n&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="433-mise-en-oeuvre-des-tâches-automatiques">4.3.3. Mise en oeuvre des tâches automatiques<a href="#433-mise-en-oeuvre-des-tâches-automatiques" class="hash-link" aria-label="Direct link to 4.3.3. Mise en oeuvre des tâches automatiques" title="Direct link to 4.3.3. Mise en oeuvre des tâches automatiques">​</a></h3>
<p>Il faut modifier le fichier de configuration de <code>crontab</code> (planificateur de tâches intégré à l&#x27;OS) pour exécuter la sauvegarde et la suppression des anciennes backups, avec <code>crontab -e</code> :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> 0 1 * * * /home/backup-server/scripts/backup.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 5 1 * * * /home/backup-server/scripts/remove.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Ici, la sauvegarde et la suppression s&#x27;exécuteront respectivement à 1h00 et 1h05.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="44-serveur-honeypot-honeypot">4.4 Serveur honeypot (HONEYPOT)<a href="#44-serveur-honeypot-honeypot" class="hash-link" aria-label="Direct link to 4.4 Serveur honeypot (HONEYPOT)" title="Direct link to 4.4 Serveur honeypot (HONEYPOT)">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="441-configuration-initiale">4.4.1. Configuration initiale<a href="#441-configuration-initiale" class="hash-link" aria-label="Direct link to 4.4.1. Configuration initiale" title="Direct link to 4.4.1. Configuration initiale">​</a></h3>
<table><thead><tr><th>Hostname</th><th>very-important-and-private-and-secret-server</th></tr></thead><tbody><tr><td><strong>Domaine</strong></td><td>infra.uf</td></tr><tr><td><strong>Nom de l&#x27;utilisateur</strong></td><td>user</td></tr><tr><td><strong>Adresse IP</strong></td><td>10.10.11.242</td></tr><tr><td><strong>Masque de sous-réseau</strong></td><td>255.255.255.240 (/28)</td></tr><tr><td><strong>Passerelle par défaut</strong></td><td>10.10.11.254</td></tr><tr><td><strong>DNS</strong></td><td>10.10.11.254</td></tr><tr><td><strong>Ports ouverts (honeypot)</strong></td><td>80, 8080, 20, 21, 22, 23, 25, 443, 8443, 53</td></tr><tr><td><strong>Ports ouverts (réels)</strong></td><td>64295 (ssh), 64297 (https, monitoring), 64294 (https, admin-ui)</td></tr></tbody></table>
<p>T-Pot est une plateforme honeypot open-source tout-en-un qui intègre plusieurs honeypots et outils de sécurité pour la détection et l&#x27;analyse des menaces cyber. T-Pot vise à simplifier le processus de déploiement et de gestion des honeypots pour les organisations. Il sert de solution complète de honeypot qui peut être adaptée pour répondre à des besoins de sécurité spécifiques.</p>
<p>Pour mettre en place le honeypot, il sera nécessaire de l&#x27;installer sur un serveur. Par défaut, un serveur Ubuntu a été sélectionné pour cette installation.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="442-installation-de-t-pot-sur-le-serveur">4.4.2 Installation de T-Pot sur le serveur<a href="#442-installation-de-t-pot-sur-le-serveur" class="hash-link" aria-label="Direct link to 4.4.2 Installation de T-Pot sur le serveur" title="Direct link to 4.4.2 Installation de T-Pot sur le serveur">​</a></h3>
<ol>
<li>Clonez le dépôt Github : <code>$ git clone https://github.com/telekom-security/tpotce</code></li>
<li>Accédez au dossier tpotce/ : <code>$ cd tpotce</code></li>
<li>Lancez le script d&#x27;installation : <code>$ ./install.sh</code></li>
<li>Suivez les instructions de l&#x27;installateur et entrez votre mot de passe si nécessaire. Le type d&#x27;installation souhaité vous sera demandé, il faudra indiquer <code>h</code> pour HIVE. Il faudra aussi renseigner un nom d&#x27;utilisateur et un nouveau mot de passe pour l&#x27;interface Web.</li>
<li>Vérifiez attentivement les messages de l&#x27;installateur pour détecter d&#x27;éventuelles erreurs ou conflits de ports.</li>
<li>Redémarrez votre machine : <code>$ sudo reboot</code></li>
</ol>
<p>Une fois la machine redémarrée, vérifiez l&#x27;état des images Docker avec <code>docker ps</code> et du service tpotce avec <code>sudo systemctl status tpotce</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="443-configuration-du-pare-feu-dans-t-pot-ufw">4.4.3 Configuration du pare-feu dans T-Pot (UFW)<a href="#443-configuration-du-pare-feu-dans-t-pot-ufw" class="hash-link" aria-label="Direct link to 4.4.3 Configuration du pare-feu dans T-Pot (UFW)" title="Direct link to 4.4.3 Configuration du pare-feu dans T-Pot (UFW)">​</a></h3>
<p>Autorisez l&#x27;ouverture des ports qui vont être exposés :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo ufw allow from any to &lt;ip-tpot&gt; port 80 proto tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo ufw allow from any to &lt;ip-tpot&gt; port 8080 proto tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo ufw allow from any to &lt;ip-tpot&gt; port 20 proto tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo ufw allow from any to &lt;ip-tpot&gt; port 21 proto tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo ufw allow from any to &lt;ip-tpot&gt; port 22 proto tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo ufw allow from any to &lt;ip-tpot&gt; port 23 proto tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo ufw allow from any to &lt;ip-tpot&gt; port 25 proto tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo ufw allow from any to &lt;ip-tpot&gt; port 443 proto tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo ufw allow from any to &lt;ip-tpot&gt; port 8443 proto tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo ufw allow from any to &lt;ip-tpot&gt; port 53 proto udp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Ensuite, activez la journalisation du pare-feu avec <code>sudo ufw logging on</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="444-règles-de-pare-feu-et-port-forwarding-pfsense">4.4.4. Règles de pare-feu et port-forwarding (pfSense)<a href="#444-règles-de-pare-feu-et-port-forwarding-pfsense" class="hash-link" aria-label="Direct link to 4.4.4. Règles de pare-feu et port-forwarding (pfSense)" title="Direct link to 4.4.4. Règles de pare-feu et port-forwarding (pfSense)">​</a></h3>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="45-pc-clients">4.5. PC clients<a href="#45-pc-clients" class="hash-link" aria-label="Direct link to 4.5. PC clients" title="Direct link to 4.5. PC clients">​</a></h2>
<p>Les PC client (Windows ou Linux) n&#x27;ont pas de configuration particulière spécifiée dans le cahier des charges. Elles n&#x27;ont pas d&#x27;impératif de nomenclature pour les noms des machines et utilisateurs, ni de logiciels hors ceux spécifiés plus tôt.</p>
<p>Tant qu&#x27;ils sont reliés au réseau <code>LAN-OFFICE</code>, leurs paramètres réseau seront configurés automatiquement, par DHCP. Elles récupéreront ainsi une IP libre de la pool DHCP de <code>LAN-OFFICE</code>.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/architecture/composants-applicatifs"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">3. Liste des composants applicatifs</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/category/documentation-dexploitation"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Documentation d&#x27;exploitation</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#41-serveurs-pfsense" class="table-of-contents__link toc-highlight">4.1. Serveurs pfSense</a><ul><li><a href="#411-configuration-des-interfaces" class="table-of-contents__link toc-highlight">4.1.1. Configuration des interfaces</a></li><li><a href="#412-paramétrage-basique-des-serveurs" class="table-of-contents__link toc-highlight">4.1.2. Paramétrage basique des serveurs</a></li><li><a href="#413-configuration-de-la-haute-disponibilité-failover" class="table-of-contents__link toc-highlight">4.1.3. Configuration de la haute disponibilité (<code>failover</code>)</a></li><li><a href="#414-règles-de-base-du-pare-feu" class="table-of-contents__link toc-highlight">4.1.4. Règles de base du pare-feu</a></li><li><a href="#415-dhcp" class="table-of-contents__link toc-highlight">4.1.5. DHCP</a></li><li><a href="#416-dns" class="table-of-contents__link toc-highlight">4.1.6. DNS</a></li><li><a href="#417-port-forwarding" class="table-of-contents__link toc-highlight">4.1.7. Port Forwarding</a></li><li><a href="#418-ripv2" class="table-of-contents__link toc-highlight">4.1.8. RIPv2</a></li><li><a href="#419-portail-captif" class="table-of-contents__link toc-highlight">4.1.9. Portail captif</a></li><li><a href="#4110-sauvegarde-automatique-de-la-configuration" class="table-of-contents__link toc-highlight">4.1.10. Sauvegarde automatique de la configuration</a></li><li><a href="#4111-proxy-inverse" class="table-of-contents__link toc-highlight">4.1.11. Proxy Inverse</a></li></ul></li><li><a href="#42-serveur-web-dmz" class="table-of-contents__link toc-highlight">4.2. Serveur web (DMZ)</a><ul><li><a href="#421-configuration-initiale" class="table-of-contents__link toc-highlight">4.2.1. Configuration initiale</a></li><li><a href="#422-mise-en-place-du-serveur-web" class="table-of-contents__link toc-highlight">4.2.2. Mise en place du serveur web</a></li><li><a href="#423-mise-en-place-des-fichiers-de-restauration" class="table-of-contents__link toc-highlight">4.2.3. Mise en place des fichiers de restauration</a></li></ul></li><li><a href="#43-serveurs-web-backup-lan-serv" class="table-of-contents__link toc-highlight">4.3. Serveurs web-backup (LAN-SERV)</a><ul><li><a href="#431-configuration-initiale" class="table-of-contents__link toc-highlight">4.3.1. Configuration initiale</a></li><li><a href="#432-mise-en-place-des-fichiers-de-sauvegarde-et-de-restauration" class="table-of-contents__link toc-highlight">4.3.2. Mise en place des fichiers de sauvegarde et de restauration</a></li><li><a href="#433-mise-en-oeuvre-des-tâches-automatiques" class="table-of-contents__link toc-highlight">4.3.3. Mise en oeuvre des tâches automatiques</a></li></ul></li><li><a href="#44-serveur-honeypot-honeypot" class="table-of-contents__link toc-highlight">4.4 Serveur honeypot (HONEYPOT)</a><ul><li><a href="#441-configuration-initiale" class="table-of-contents__link toc-highlight">4.4.1. Configuration initiale</a></li><li><a href="#442-installation-de-t-pot-sur-le-serveur" class="table-of-contents__link toc-highlight">4.4.2 Installation de T-Pot sur le serveur</a></li><li><a href="#443-configuration-du-pare-feu-dans-t-pot-ufw" class="table-of-contents__link toc-highlight">4.4.3 Configuration du pare-feu dans T-Pot (UFW)</a></li><li><a href="#444-règles-de-pare-feu-et-port-forwarding-pfsense" class="table-of-contents__link toc-highlight">4.4.4. Règles de pare-feu et port-forwarding (pfSense)</a></li></ul></li><li><a href="#45-pc-clients" class="table-of-contents__link toc-highlight">4.5. PC clients</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/category/documentation-darchitecture">Documentation d&#x27;architecture</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/category/documentation-dexploitation">Documentation d&#x27;exploitation</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/gestion-projet">Gestion de projet</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Eva Chibane & Marianne Corbel. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>